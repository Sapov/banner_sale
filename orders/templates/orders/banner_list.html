{% extends "base.html" %}
{% load i18n %}
{% load account socialaccount %}
{% load crispy_forms_tags %}
{% load thumbnail %}

{% block content %}

<div class="container">
    <h1>üìÅ –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã</h1>

    {% if object_list %}
    <div class="stats">
        <p>–í—Å–µ–≥–æ –±–∞–Ω–Ω–µ—Ä–æ–≤: <strong>{{ total_count }}</strong></p>
    </div>

    <div class="banners-grid">
        {% for banner in object_list %}
        <div class="banner-card">
            <div class="banner-image">
                {% if banner.image %}
                <img src="{% thumbnail banner.image 200x0 %}" alt="–ë–∞–Ω–Ω–µ—Ä {{ banner.id }}"
                     data-full-image="{{ banner.image.url }}">
                {% else %}
                <div class="no-image">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                {% endif %}
            </div>

            <div class="banner-info">
                <h3>–ë–∞–Ω–Ω–µ—Ä ‚Ññ {{ banner.id }}</h3>
                <p><strong>–†–∞–∑–º–µ—Ä:</strong> {{ banner.width }}√ó{{ banner.height }} –º–º</p>
                <p><strong>–ù–∞–¥–ø–∏—Å—å:</strong> {{ banner.text|default:"-" }}</p>
                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ banner.phone|default:"-" }}</p>
                <p><strong>–î–∞—Ç–∞:</strong> {{ banner.created_at|date:"d.m.Y H:i" }}</p>

                <div class="banner-colors">
                    <strong>–¶–≤–µ—Ç —Ñ–æ–Ω–∞:</strong><span class="color-box"
                                                     style="background-color: {{ banner.bg_color }}"></span>
                    <strong>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞:</strong><span class="color-box"
                                                       style="background-color: {{ banner.text_color }}"></span>
                </div>
                <h4><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ banner.price_banner }} —Ä—É–±.</h4>

                <div class="banner-actions">
                    <button class="btn-view" data-image-url="{{ banner.image.url }}">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                    <a href="{% url 'banner_delete' banner.id %}" class="btn-delete">–£–¥–∞–ª–∏—Ç—å</a>
                </div>
                <div class="banner-actions">
                    <a href="#" class="btn-choice">–í—ã–±—Ä–∞—Ç—å –ü–í–ó –¥–æ—Å—Ç–∞–≤–∫–∏</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <div id="imageModal" class="modal">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modalImage">
        <div id="modalCaption"></div>
    </div>

    {% else %}
    <div class="empty-state">
        <h2>üòî –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –±–∞–Ω–Ω–µ—Ä–æ–≤</h2>
        <p>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –±–∞–Ω–Ω–µ—Ä!</p>
        <a href="/" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –±–∞–Ω–Ω–µ—Ä</a>
    </div>
    {% endif %}
</div>

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .stats {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .banners-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .banner-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .banner-card:hover {
        transform: translateY(-5px);
    }

    .banner-image {
        height: 200px;
        overflow: hidden;
        background: #f5f5f5;
        cursor: pointer;
    }

    .banner-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .banner-image img:hover {
        transform: scale(1.05);
    }

    .no-image {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-style: italic;
    }

    .banner-info {
        padding: 20px;
    }

    .banner-info h3 {
        margin: 0 0 15px 0;
        color: #333;
    }

    .banner-info p {
        margin: 8px 0;
        color: #666;
        font-size: 14px;
    }

    .banner-colors {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        align-items: center;
    }

    .color-box {
        width: 25px;
        height: 25px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    .banner-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-view, .btn-delete, .btn-choice {
        flex: 1;
        text-align: center;
        padding: 10px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-family: inherit;
    }

    .btn-view {
        background: #4CAF50;
        color: white;
    }

    .btn-view:hover {
        background: #45a049;
    }

    .btn-delete {
        background: #f44336;
        color: white;
    }

    .btn-delete:hover {
        background: #d32f2f;
    }

    .btn-choice {
        background: #ff9800;
        color: white;
    }

    .btn-choice:hover {
        background: #f57c00;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-top: 50px;
    }

    .empty-state h2 {
        color: #666;
        margin-bottom: 20px;
    }

    .btn-primary {
        display: inline-block;
        background: #2196F3;
        color: white;
        padding: 12px 30px;
        border-radius: 6px;
        text-decoration: none;
        margin-top: 20px;
        font-weight: bold;
    }

    .btn-primary:hover {
        background: #0b7dda;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal.show {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 0 40px rgba(255, 255, 255, 0.1);
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }

    .modal.show .modal-content {
        transform: scale(1);
    }

    .modal-close {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
        z-index: 1001;
    }

    .modal-close:hover {
        color: #bbb;
    }

    #modalCaption {
        position: absolute;
        bottom: 20px;
        left: 0;
        width: 100%;
        text-align: center;
        color: white;
        padding: 10px;
        background: rgba(0, 0, 0, 0.7);
        font-size: 16px;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    const viewButtons = document.querySelectorAll('.btn-view');
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalClose = document.querySelector('.modal-close');
    const modalCaption = document.getElementById('modalCaption');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function openModal(imageUrl, caption = '') {
        modalImage.src = imageUrl;
        modalImage.alt = caption;
        modalCaption.textContent = caption;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        modal.classList.add('show');
        document.body.style.overflow = 'hidden'; // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function closeModal() {
        modal.classList.remove('show');
        document.body.style.overflow = ''; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const imageUrl = this.getAttribute('data-image-url');
            const bannerId = this.closest('.banner-card').querySelector('h3').textContent;
            openModal(imageUrl, bannerId);
        });
    });

    // –¢–∞–∫–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–∞–º–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
    document.querySelectorAll('.banner-image img').forEach(img => {
        img.addEventListener('click', function() {
            const fullImageUrl = this.getAttribute('data-full-image') || this.src;
            const bannerId = this.closest('.banner-card').querySelector('h3').textContent;
            openModal(fullImageUrl, bannerId);
        });
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
    modalClose.addEventListener('click', closeModal);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    modal.addEventListener('click', function(event) {
        if (event.target === modal) {
            closeModal();
        }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–ª–∞–≤–∏—à–∏ Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && modal.classList.contains('show')) {
            closeModal();
        }
    });

    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    modalImage.addEventListener('load', function() {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
    });

    modalImage.addEventListener('error', function() {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
        modalCaption.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è';
    });
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (Native Fullscreen API)
function toggleFullscreen(element) {
    if (!document.fullscreenElement) {
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.webkitRequestFullscreen) { /* Safari */
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) { /* IE11 */
            element.msRequestFullscreen();
        }
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { /* Safari */
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE11 */
            document.msExitFullscreen();
        }
    }
}

// –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:
function addFullscreenButton() {
    const modalImage = document.getElementById('modalImage');

    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    const fullscreenBtn = document.createElement('button');
    fullscreenBtn.innerHTML = '‚õ∂';
    fullscreenBtn.style.position = 'absolute';
    fullscreenBtn.style.top = '20px';
    fullscreenBtn.style.left = '35px';
    fullscreenBtn.style.background = 'rgba(0,0,0,0.7)';
    fullscreenBtn.style.color = 'white';
    fullscreenBtn.style.border = 'none';
    fullscreenBtn.style.borderRadius = '4px';
    fullscreenBtn.style.padding = '10px 15px';
    fullscreenBtn.style.fontSize = '20px';
    fullscreenBtn.style.cursor = 'pointer';
    fullscreenBtn.style.zIndex = '1001';
    fullscreenBtn.title = '–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º';

    fullscreenBtn.addEventListener('click', function() {
        toggleFullscreen(modalImage);
    });

    document.getElementById('imageModal').appendChild(fullscreenBtn);
}

// –í—ã–∑–æ–≤–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
// document.addEventListener('DOMContentLoaded', addFullscreenButton);
</script>
{% endblock %}